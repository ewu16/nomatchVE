% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/get_one_nomatch_ve.R
\name{get_one_nomatch_ve}
\alias{get_one_nomatch_ve}
\title{Internal function to compute VE point estimate}
\usage{
get_one_nomatch_ve(
  data,
  outcome_name,
  event_name,
  trt_name,
  time_name,
  adjust_vars,
  times,
  censor_time,
  tau,
  weighting = c("observed", "custom", "matched"),
  custom_weights = NULL,
  matched_dist_options = NULL,
  formula_0 = NULL,
  formula_1 = NULL,
  return_models = TRUE,
  return_gp_list = TRUE,
  return_matching = TRUE
)
}
\arguments{
\item{data}{A data frame with one row per individual containing
the columns named in \code{outcome_name}, \code{event_name}, \code{trt_name}, \code{time_name},
and any variables listed in \code{adjust_vars}.}

\item{outcome_name}{Name of the possibly-censored time-to-event variable, measured from the chosen time origin.}

\item{event_name}{Name of the event indicator. The underlying column should be numeric
(\code{1} = event, \code{0} = censored).}

\item{trt_name}{Name of the exposure indicator. The underlying column should be numeric
(\code{1} = exposed during follow-up, \code{0} = never exposed during follow-up). Exposure indicator
should indicate whether an individual is exposed while uncensored and before experiencing the endpoint of interest.}

\item{time_name}{Name of the time to exposure, measured from the chosen time origin; use \code{NA} if not exposed.}

\item{adjust_vars}{Character vector of baseline covariates to adjust for when fitting the hazard models.}

\item{times}{Numeric vector of time after exposure at which to evaluate VE. All values must be greater than tau and
should reflect meaningful clinical timepoints (e.g., 30, 60, 90 days).}

\item{censor_time}{Time after exposure at which exposed
individuals are administratively censored during model fitting. Default:
\code{max(times)}. This is used to limit borrowing of information from beyond the time period of interest.}

\item{tau}{Time after exposure (vaccination)  to exclude as part of an "immune build-up" period. Must be non-negative.
Common values may include 0 days (no delay), 7 days (one week), 14 days (two weeks) and should
match the biological understanding of when vaccine-induced immunity develops.}

\item{weighting}{Character string specifying how to construct marginalizing weights.
#'   One of:
\itemize{
\item \code{"observed"} (default): estimate weights from the observed data;
\item \code{"custom"}: use user-specified weights provided via \code{custom_weights} argument;
\item \code{"matched"}: estimate weights from a matched cohort (for historical purposes).
}}

\item{custom_weights}{a \code{list(g_dist, p_dist)} providing custom weights for marginalization.
Must have the following format:
\itemize{
\item \code{g_dist}: data frame with columns
\itemize{
\item \code{time_name} (time of exposure),
\item all variables in \code{adjust_vars}
\item \code{group_name} (unique identifier for each covariate-group),
\item \code{prob} (probability of exposure at the given time within the covariate-group. Should sum to 1 within each covariate-group)
}
\item \code{p_dist}: data frame with columns
\itemize{
\item all variables in \code{adjust_vars}
\item \code{prob} (probability of covariate-group. Should sum to 1 over all covariate groups.)
}
}}

\item{matched_dist_options}{If \code{weighting = "matched"}, a list of
options created by \code{\link[=matched_dist]{matched_dist()}} controlling how the matched dataset
is used to estimate the marginalizing distributions.}

\item{formula_0}{Either a formula or a pre-fit \code{coxph} model object for the
unvaccinated hazard (calendar-time scale). If a fitted model is provided,
it will be used directly instead of fitting a new model. Intended for advanced use.}

\item{formula_1}{Either a formula or a pre-fit  \code{coxph} model object for the
vaccinated hazard (time-since-vaccination scale). If a fitted model is provided,
it will be used directly instead of fitting a new model. Intended for advanced use.}

\item{return_models}{Logical; return fitted conditional hazard models?
Default: \code{TRUE}.}

\item{return_matching}{Logical; return matched datasets? Default is
TRUE if \code{weighting = "matched"}. When \code{weighting != "matched"}, this is
automatically set to \code{FALSE}.}
}
\value{
List with components:
\describe{
\item{estimates}{Matrix: \code{cuminc_0}, \code{cuminc_1}, \code{ve} (rows = timepoints)}
\item{model_0, model_1}{Fitted Cox models (if \code{return_models = TRUE})}
\item{gp_list}{Marginalizing distributions (if \code{return_gp_list = TRUE})}
\item{matched_data, matched_adata}{Matched datasets (if \code{weighting = "matched"})}
}
}
\description{
This is an internal function that performs the actual VE computation.
It is called by \code{\link[=nomatchVE]{nomatchVE()}},\code{\link[=nomatchVE_advanced]{nomatchVE_advanced()}}, and \code{\link[=one_boot_nomatch]{one_boot_nomatch()}}. Handles
different weighting schemes in a unified way. Users should typically call
these functions rather than calling this function directly.
}
\keyword{internal}
