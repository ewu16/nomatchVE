---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# R/`nomatchVE`

> A matching alternative for more efficiently evaluating vaccine effectiveness using observational data


## Description

The `nomatchVE` package uses a G-computation style estimator to compute vaccine effectiveness from observational vaccine studies. The proposed estimator tends to produce similar point estimates as matching-based estimators but can be more efficient.

## Installation

You can install the development version of `nomatchVE` with:

``` r
# install.packages("devtools")
devtools::install_github("ewu16/nomatchVE")
```

## Example

This minimal example shows how to use `nomatchVE` to obtain cumulative incidence and vaccine effectiveness estimates in a simple simulated data set.

```{r example, fig.width = 8, fig.height = 4}
#Load package
library(nomatchVE)

# Example data
head(simdata)
summary(simdata)
```

```{r, include = FALSE}
# ------------------------------------------------------------------------------
# Set input parameters
data <- simdata 
outcome_time <- "Y"
outcome_status <- "event"
exposure <- "V"
exposure_time <- "D_obs"
covariates <- c("x1", "x2")

eval_times <- seq(30, 180, by = 30)
censor_time <- max(eval_times)
tau <- 14
ci_type <- "wald"
boot_reps <- 10
alpha <- .05

id_name <- "ID"
matching_vars <- covariates
```

```{r}

# Compute cumulative incidence 
fit1 <- nomatchVE(data = simdata,
                  outcome_time = "Y",
                  outcome_status = "event",
                  exposure = "V",
                  exposure_time = "D_obs", 
                  covariates = c("x1", "x2"),
                  tau = 14,
                  eval_times = seq(30, 180, by = 30),
                  boot_reps = 10)

#Print results 
fit1        

#Summary 
summary(fit1)

#Plot pointwise intervals 
plot(fit1) 

#Compute simultaneous CI
fit1_with_simul <- add_simultaneous_ci(fit1, seed = 1234)

#Plot simultaneous confidence bands 
plot(fit1_with_simul , ci_type = "simul") 
```

```{r}
# ------------------------------------------------------------------------------
# 3. Compare results with matching estimator



matched_cohort <- match_rolling_cohort(data = simdata,
                                       outcome_time = "Y",
                                       exposure = "V",
                                       exposure_time = "D_obs", 
                                       matching_vars = c("x1", "x2"),
                                       id_name = "ID",
                                       seed = 5678)

matched_data <- matched_cohort[[1]]


fit_matching <-matching_ve(matched_data = matched_data,
                           outcome_time = "Y",
                           outcome_status = "event",
                           exposure = "V",
                           exposure_time = "D_obs", 
                           tau = 14,
                           eval_times = seq(30, 180, by = 30),
                           boot_reps = 10) 

fit_matching

## Plot matching vs proposed estimator - nomatch tends to have similar point estimates but narrower
# confidence intervals
compare_ve_fits(fit_matching, fit1, labels = c("Matching", "nomatch (G-computation)"))
```

## Issues

If you encounter any bugs or have any specific feature requests, please [file an issue](https://github.com/ewu16/nomatchVE/issues).

## Citation

If you use the `nomatchVE` package in your work, please cite the following:

```{r, include = FALSE}
c <- citation("nomatchVE")
toBibtex(c)
```

```
 @Manual{,
   title = {nomatchVE: Estimate Causal Vaccine Effectiveness in Observational Studies
             Without Matching},
   author = {Emily Wu},
   year = {2025},
   note = {R package version 0.0.0.9000, 
   https://github.com/ewu16/nomatchVE},
   url = {https://ewu16.github.io/nomatchVE/},
 }
 ```
 

