<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Main function to estimate marginal cumulative incidences and derived effect measures without matching — nomatchVE • nomatchVE</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Main function to estimate marginal cumulative incidences and derived effect measures without matching — nomatchVE"><meta name="description" content="nomatchVE() estimates marginal cumulative incidences under
exposure and no exposure using a G-computation approach. The method fits two
conditional hazard models- one for unexposed and one for the exposed- and uses
these models to predict time- and covariate- specific cumulative incidences.
The predicted conditional risks are then marginalized to compute overall
(marginal) cumulative incidences. The resulting cumulative incidences can be
summarized as risk ratios (RR) or 1 - RR (vaccine effectiveness)."><meta property="og:description" content="nomatchVE() estimates marginal cumulative incidences under
exposure and no exposure using a G-computation approach. The method fits two
conditional hazard models- one for unexposed and one for the exposed- and uses
these models to predict time- and covariate- specific cumulative incidences.
The predicted conditional risks are then marginalized to compute overall
(marginal) cumulative incidences. The resulting cumulative incidences can be
summarized as risk ratios (RR) or 1 - RR (vaccine effectiveness)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nomatchVE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ewu16/nomatchVE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Main function to estimate marginal cumulative incidences and derived effect measures without matching</h1>
      <small class="dont-index">Source: <a href="https://github.com/ewu16/nomatchVE/blob/main/R/nomatchVE.R" class="external-link"><code>R/nomatchVE.R</code></a></small>
      <div class="d-none name"><code>nomatchVE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>nomatchVE()</code> estimates marginal cumulative incidences under
exposure and no exposure using a G-computation approach. The method fits two
conditional hazard models- one for unexposed and one for the exposed- and uses
these models to predict time- and covariate- specific cumulative incidences.
The predicted conditional risks are then marginalized to compute overall
(marginal) cumulative incidences. The resulting cumulative incidences can be
summarized as risk ratios (RR) or 1 - RR (vaccine effectiveness).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">nomatchVE</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">outcome_time</span>,</span>
<span>  <span class="va">outcome_status</span>,</span>
<span>  <span class="va">exposure</span>,</span>
<span>  <span class="va">exposure_time</span>,</span>
<span>  <span class="va">covariates</span>,</span>
<span>  <span class="va">tau</span>,</span>
<span>  <span class="va">eval_times</span>,</span>
<span>  effect <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"vaccine_effectiveness"</span>, <span class="st">"risk_ratio"</span><span class="op">)</span>,</span>
<span>  weights_source <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observed"</span>, <span class="st">"custom"</span><span class="op">)</span>,</span>
<span>  custom_weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ci_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wald"</span>, <span class="st">"percentile"</span>, <span class="st">"both"</span><span class="op">)</span>,</span>
<span>  boot_reps <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  keep_models <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  keep_boot_samples <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  n_cores <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame with one row per individual containing the columns
named in <code>outcome_time</code>, <code>outcome_status</code>, <code>exposure</code>, <code>exposure_time</code>, and any
variables listed in <code>covariates</code>.</p></dd>


<dt id="arg-outcome-time">outcome_time<a class="anchor" aria-label="anchor" href="#arg-outcome-time"></a></dt>
<dd><p>Name of the time-to-event/censoring variable. Time should
be measured from a given time origin (e.g. study start, enrollment, or age)
for all individuals.</p></dd>


<dt id="arg-outcome-status">outcome_status<a class="anchor" aria-label="anchor" href="#arg-outcome-status"></a></dt>
<dd><p>Name of the event indicator. The underlying column should be
numeric (<code>1</code> = event, <code>0</code> = censored).</p></dd>


<dt id="arg-exposure">exposure<a class="anchor" aria-label="anchor" href="#arg-exposure"></a></dt>
<dd><p>Name of the exposure indicator. The underlying column should
be numeric (<code>1</code> = exposed during follow-up, <code>0</code> = never exposed during
follow-up).</p></dd>


<dt id="arg-exposure-time">exposure_time<a class="anchor" aria-label="anchor" href="#arg-exposure-time"></a></dt>
<dd><p>Name of the time to exposure, measured from the chosen time
origin; use <code>NA</code> if not exposed. Time must be measured in the same units
(e.g. days) as that used for  <code>outcome_time</code>.</p></dd>


<dt id="arg-covariates">covariates<a class="anchor" aria-label="anchor" href="#arg-covariates"></a></dt>
<dd><p>Character vector of covariates to adjust for when fitting
the hazard models. These covariates should include all known confounders of
exposure and censoring measured at the chosen time origin.</p></dd>


<dt id="arg-tau">tau<a class="anchor" aria-label="anchor" href="#arg-tau"></a></dt>
<dd><p>Non-negative numeric value specifying the time after exposure that
should be excluded from the risk evaluation period. This argument is
primarily intended for vaccination exposures, where it is common to exclude
the time after vaccination when immunity is still building. Time must be
measured in the same units as that used for <code>outcome_time</code> and <code>exposure_time</code>
and should reflect the biological understanding of when vaccine-induced
immunity develops (usually 1-2 weeks). For non-vaccine exposures, <code>tau</code> can
be set to 0 (no delay period).</p></dd>


<dt id="arg-eval-times">eval_times<a class="anchor" aria-label="anchor" href="#arg-eval-times"></a></dt>
<dd><p>Numeric vector specifying the timepoints at which to compute
cumulative incidence and the derived effect measures. The timepoints should
be expressed in terms of time since exposure. All values must be greater
than <code>tau</code> and and should correspond to clinically meaningful follow-up
durations, such as 30, 60, or 90 days after exposure. A fine grid of
timepoints (e.g., <code>eval_times = (tau+1):100</code>) can be provided if cumulative
incidence curves over time are desired.</p></dd>


<dt id="arg-effect">effect<a class="anchor" aria-label="anchor" href="#arg-effect"></a></dt>
<dd><p>Character. Type of effect measure to compute and return,
based on the estimated cumulative incidences. Either
<code>"vaccine_effectiveness"</code> (default) or <code>"risk_ratio"</code>.</p></dd>


<dt id="arg-weights-source">weights_source<a class="anchor" aria-label="anchor" href="#arg-weights-source"></a></dt>
<dd><p>Character string specifying the type of marginalizing weights
to use. Either:</p><ul><li><p><code>"observed"</code> (default): set the marginalizing weights to the empirical
distribution of exposure eval_times and covariates among the exposed. This
provides close alignment with the weights implicitly used in matching.</p></li>
<li><p><code>"custom"</code>: use the user-specified weights provided in the <code>custom_weights</code> argument.</p></li>
</ul></dd>


<dt id="arg-custom-weights">custom_weights<a class="anchor" aria-label="anchor" href="#arg-custom-weights"></a></dt>
<dd><p>a <code>list(g_weights, p_weights)</code> providing weights for
marginalizing the time- and covariate-specific cumulative incidences. Must
have the following format:</p><ul><li><p><code>g_weights</code>: data frame with columns</p><ul><li><p>all variables in <code>covariates</code></p></li>
<li><p><code>exposure_time</code> (time of exposure),</p></li>
<li><p><code>prob</code> (probability of exposure at the given time within the covariate-group;
should sum to 1 within each covariate-group)</p></li>
</ul></li>
<li><p><code>p_weights</code>: data frame with columns</p><ul><li><p>all variables in <code>covariates</code></p></li>
<li><p><code>prob</code> (probability of covariate-group; should sum to 1 over all covariate groups.)</p></li>
</ul></li>
</ul></dd>


<dt id="arg-ci-type">ci_type<a class="anchor" aria-label="anchor" href="#arg-ci-type"></a></dt>
<dd><p>Method for constructing bootstrap confidence intervals. One of
<code>"wald"</code>, <code>"percentile"</code>, or <code>"both"</code>.</p><ul><li><p><code>"wald"</code> (default): Computes Wald-style intervals using bootstrap standard errors.
See <strong>Confidence intervals</strong> section for details.</p></li>
<li><p><code>"percentile"</code>: Computes percentile bootstrap intervals.</p></li>
<li><p><code>"both"</code>: Computes and returns both sets of intervals.</p></li>
</ul></dd>


<dt id="arg-boot-reps">boot_reps<a class="anchor" aria-label="anchor" href="#arg-boot-reps"></a></dt>
<dd><p>Number of bootstrap replicates for confidence intervals.
Recommended to use at least 1000 for publication-quality results. Use
smaller values (e.g., 10-100) for initial exploration. Default: <code>0</code> (no
bootstrapping).</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Significance level for confidence intervals (Confidence level =
100*(1-<code>alpha</code>)%). Default: <code>0.05</code>.</p></dd>


<dt id="arg-keep-models">keep_models<a class="anchor" aria-label="anchor" href="#arg-keep-models"></a></dt>
<dd><p>Logical; return the two fitted hazard models used to compute
cumulative incidences?
Default: <code>TRUE</code>.</p></dd>


<dt id="arg-keep-boot-samples">keep_boot_samples<a class="anchor" aria-label="anchor" href="#arg-keep-boot-samples"></a></dt>
<dd><p>Logical; return bootstrap samples? Default:
<code>TRUE</code>. Must be set to <code>TRUE</code> if user plans to use <code><a href="add_simultaneous_ci.html">add_simultaneous_ci()</a></code>
to obtain simultaneous confidence intervals.</p></dd>


<dt id="arg-n-cores">n_cores<a class="anchor" aria-label="anchor" href="#arg-n-cores"></a></dt>
<dd><p>Integer; parallel cores for bootstrapping. Passed to
<code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply</a></code> as <code>mc.cores</code>. On Unix-like OS only; not available on
Windows. Default: <code>1</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class <code>vefit</code> containing:</p><dl><dt>estimates</dt>
<dd><p>List of matrices:</p><dl><dt><code>cuminc_0</code></dt>
<dd><p>marginal cumulative incidence under no exposure</p></dd>

<dt><code>cuminc_1</code></dt>
<dd><p>marginal cumulative incidence under exposure</p></dd>

<dt><code>&lt;effect&gt;</code></dt>
<dd><p>the selected effect measure under the same name</p></dd>


</dl><p>Each matrix has one row per value in <code>eval_times</code> and columns including the
point estimate (<code>estimate</code>) and, when requested, confidence limits of the form
(<code>{wald/percentile}_lower</code>, <code>{wald/percentile}_upper</code>).</p></dd>

<dt>gp_list</dt>
<dd><p>List with dataframes <code>g_weights</code>, <code>p_weights</code> specifying
the marginalizing weights used for averaging over exposure eval_times and covariates.</p></dd>

<dt>model_0</dt>
<dd><p>Fitted hazard model for the unexposed group.
See <strong>Modeling</strong> section for details.</p></dd>

<dt>model_1</dt>
<dd><p>Fitted hazard model for the exposed group.
See <strong>Modeling</strong> section for details.</p></dd>

<dt>n_success_boot</dt>
<dd><p>Integer vector indicating the
number of successful bootstrap replications per timepoint.</p></dd>

<dt>boot_samples</dt>
<dd><p>(If <code>keep_boot_samples = TRUE</code>) List of bootstrap draws
(stored as matrices) for each
returned quantity with names mirroring those in <code>estimates</code> (i.e. <code>cuminc_0</code>, <code>cuminc_1</code>, <code>&lt;effect</code>).
Rows index bootstrap replicates and columns index <code>eval_times</code>.</p></dd>


</dl><p>The <code>vefit</code> object has methods for <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, and <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>.
Use <code><a href="add_simultaneous_ci.html">add_simultaneous_ci()</a></code> to add simultaneous confidence intervals.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Modeling.</strong> Two Cox proportional hazards models are fit to estimate
exposure-specific cumulative incidences. The first models the hazard of the
outcome over the chosen time scale among individuals who have not yet been
exposed, with exposed individuals censored at their time of exposure. The
second models the hazard over time since exposure among individuals who were
exposed and remain at risk <code>tau</code> days after exposure. Both models adjust for
the specified covariates to help control for confounding. The second model
also flexibly adjusts for exposure time (as a natural cubic spline with 4
degrees of freedom) to capture time-varying background risk. Predicted risks
from both models are then marginalized over the specified covariate and
exposure-time distributions to obtain G-computation style cumulative
incidence estimates.</p>
<p><strong>Marginalizing weights.</strong> When <code>weights_source = "observed"</code>, the marginalizing weights
are the empirical distributions of exposure eval_times and covariates among the
exposed who remain at-risk <code>tau</code> days after exposure. These weights are
returned in the <code>vefit</code> object under <code>gp_list</code>. They can also be obtained
prior to the call to <code>nomatchVE()</code> by calling <code><a href="get_observed_weights.html">get_observed_weights()</a></code>.</p>
<p><strong>Confidence intervals.</strong> Wald CIs are constructed on transformed scales:
\(\text{logit}\) for cumulative incidence; \(\log{RR}\) for risk ratios,
\(\log{1 - VE}\) for vaccine effectiveness, using bootstrap SEs. These are
then back-transformed to the original scale.</p>
<p><strong>Parallelization.</strong> Bootstraps can be parallelized on Unix via <code><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">parallel::mclapply()</a></code>
by providing <code>n_cores</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Fit vaccine effectiveness model using simulated data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">simdata</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">nomatchVE</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">simdata</span>,</span></span>
<span class="r-in"><span>  outcome_time <span class="op">=</span> <span class="st">"Y"</span>,</span></span>
<span class="r-in"><span>  outcome_status <span class="op">=</span> <span class="st">"event"</span>,</span></span>
<span class="r-in"><span>  exposure <span class="op">=</span> <span class="st">"V"</span>,</span></span>
<span class="r-in"><span>  exposure_time <span class="op">=</span> <span class="st">"D_obs"</span>,</span></span>
<span class="r-in"><span>  covariates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  eval_times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">180</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  tau <span class="op">=</span> <span class="fl">14</span>,</span></span>
<span class="r-in"><span>  boot_reps <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>  n_cores <span class="op">=</span> <span class="fl">2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bootstrapping 5 samples...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time difference of 1.371821 secs</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View basic results</span></span></span>
<span class="r-in"><span><span class="va">fit</span><span class="op">$</span><span class="va">estimates</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cuminc_0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       estimate wald_lower wald_upper wald_n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  0.01163891 0.01007963 0.01343613      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 60  0.03790915 0.03331788 0.04310488      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90  0.05857293 0.05262835 0.06514281      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 120 0.06691947 0.06032600 0.07417670      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 150 0.07548793 0.06861566 0.08298717      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 180 0.09576440 0.08852914 0.10352382      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cuminc_1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        estimate wald_lower  wald_upper wald_n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30  0.006221396 0.00490263 0.007892084      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 60  0.022928272 0.02175395 0.024164415      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90  0.035306397 0.03194971 0.039001536      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 120 0.044201057 0.04127583 0.047323360      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 150 0.055121412 0.04940982 0.061450566      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 180 0.099205626 0.09157224 0.107400100      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $vaccine_effectiveness</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        estimate wald_lower wald_upper wald_n</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 30   0.46546592  0.3216548 0.57878865      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 60   0.39517839  0.3201008 0.46196555      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 90   0.39722334  0.2812300 0.49449794      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 120  0.33948883  0.2407852 0.42536023      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 150  0.26979833  0.1526535 0.37074799      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 180 -0.03593427 -0.1511121 0.06771911      5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emily Wu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

